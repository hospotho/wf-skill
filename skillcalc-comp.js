var e=document.querySelector("#dataTables"),l=document.createElement("div");l.id="add-menu";l.style.textAlign="center";l.innerHTML="<select id='extra-type'><option value='skillsw'>\u958b\u6280\u5145\u80fd</option><option value='skillacc'>\u5145\u80fd\u901f\u5ea6</option><option value='exboost'>\u984d\u5916\u5145\u80fd</option></select><input type='button' value='+'>";l.lastChild.addEventListener("click",n);e.appendChild(l);
document.querySelectorAll("input,select").forEach(function(c){c.addEventListener("change",p)});
function n(){var c=document.querySelector("#extra-type").value,g=document.createElement("div");g.classList.add(c);"skillsw"==c?g.innerHTML="<table><tbody><tr><td colspan='4'>\u958b\u6280\u5145\u80fd</td></tr><tr><td>+U1</td><td><input class='U1skillsw1' size='4'>%<br><select class='U1skillsw-counter1'><option value='0'>\u7121\u9650\u6b21</option><option value='1'>1\u6b21</option><option value='2'>2\u6b21</option><option value='3'>3\u6b21</option><option value='4'>4\u6b21</option><option value='5'>5\u6b21</option></select></td><td><input class='U1skillsw2' size='4'>%<br><select class='U1skillsw-counter2'><option value='0'>\u7121\u9650\u6b21</option><option value='1'>1\u6b21</option><option value='2'>2\u6b21</option><option value='3'>3\u6b21</option><option value='4'>4\u6b21</option><option value='5'>5\u6b21</option></select></td><td><input class='U1skillsw3' size='4'>%<br><select class='U1skillsw-counter3'><option value='0'>\u7121\u9650\u6b21</option><option value='1'>1\u6b21</option><option value='2'>2\u6b21</option><option value='3'>3\u6b21</option><option value='4'>4\u6b21</option><option value='5'>5\u6b21</option></select></td></tr><tr><td>+U2</td><td><input class='U2skillsw1' size='4'>%<br><select class='U2skillsw-counter1'><option value='0'>\u7121\u9650\u6b21</option><option value='1'>1\u6b21</option><option value='2'>2\u6b21</option><option value='3'>3\u6b21</option><option value='4'>4\u6b21</option><option value='5'>5\u6b21</option></select></td><td><input class='U2skillsw2' size='4'>%<br><select class='U2skillsw-counter2'><option value='0'>\u7121\u9650\u6b21</option><option value='1'>1\u6b21</option><option value='2'>2\u6b21</option><option value='3'>3\u6b21</option><option value='4'>4\u6b21</option><option value='5'>5\u6b21</option></select></td><td><input class='U2skillsw3' size='4'>%<br><select class='U2skillsw-counter3'><option value='0'>\u7121\u9650\u6b21</option><option value='1'>1\u6b21</option><option value='2'>2\u6b21</option><option value='3'>3\u6b21</option><option value='4'>4\u6b21</option><option value='5'>5\u6b21</option></select></td></tr><tr><td>+U3</td><td><input class='U3skillsw1' size='4'>%<br><select class='U3skillsw-counter1'><option value='0'>\u7121\u9650\u6b21</option><option value='1'>1\u6b21</option><option value='2'>2\u6b21</option><option value='3'>3\u6b21</option><option value='4'>4\u6b21</option><option value='5'>5\u6b21</option></select></td><td><input class='U3skillsw2' size='4'>%<br><select class='U3skillsw-counter2'><option value='0'>\u7121\u9650\u6b21</option><option value='1'>1\u6b21</option><option value='2'>2\u6b21</option><option value='3'>3\u6b21</option><option value='4'>4\u6b21</option><option value='5'>5\u6b21</option></select></td><td><input class='U3skillsw3' size='4'>%<br><select class='U3skillsw-counter3'><option value='0'>\u7121\u9650\u6b21</option><option value='1'>1\u6b21</option><option value='2'>2\u6b21</option><option value='3'>3\u6b21</option><option value='4'>4\u6b21</option><option value='5'>5\u6b21</option></select></td></tr><tr><td colspan='4'><hr></td></tr></tbody></table>":"skillacc"==
c?g.innerHTML="<table><tbody><tr><td colspan='4'>\u958b\u6280\u5145\u80fd\u901f\u5ea6\u52a0\u901f</td></tr><tr><td>\u6bcf\u6b21</td><td> <input class='U1skillacc' size='4'>%</td><td> <input class='U2skillacc' size='4'>%</td><td> <input class='U3skillacc' size='4'>%</td></tr><tr><td>\u4e0a\u9650</td><td> <input class='U1skillacc-max' size='4'>%</td><td> <input class='U2skillacc-max' size='4'>%</td><td> <input class='U3skillacc-max' size='4'>%</td></tr><tr><td colspan='4'><hr></td></tr></tbody></table>":
"exboost"==c&&(g.innerHTML="<table><tbody><tr><td colspan='4'>\u984d\u5916\u5145\u80fd</td></tr><tr><td>\u6642\u9ede</td><td> <input class='U1exboost-time' size='4'></td><td> <input class='U2exboost-time' size='4'></td><td> <input class='U3exboost-time' size='4'></td></tr><tr><td>\u5145\u80fd</td><td> <input class='U1exboost-charge' size='2'>%</td><td> <input class='U2exboost-charge' size='2'>%</td><td> <input class='U3exboost-charge' size='2'>%</td></tr><tr><td colspan='4'><hr></td></tr></tbody></table>");
c=document.createElement("input");c.type="button";c.value="X";c.classList.add("delete");c.onclick=function(b){b.target.parentElement.remove();p()};g.appendChild(c);e.insertBefore(g,document.querySelector("#add-menu"));document.querySelectorAll("input,select").forEach(function(b){b.addEventListener("change",p)})}var r=[0,0,0],t=[1,1,1],u=[],v=[],w=[],x=[],y=[],z=[],A=[1,1,1],E=[],S=[];
function T(){r=[0,0,0];t=[1,1,1];u=[];v=[];w=[];x=[];y=[];z=[];A=[1,1,1];E=[];var c=Number(document.querySelector("#U1mainsw").value),g=Number(document.querySelector("#U1subsw").value),b=Number(document.querySelector("#U2mainsw").value),h=Number(document.querySelector("#U2subsw").value),k=Number(document.querySelector("#U3mainsw").value),m=Number(document.querySelector("#U3subsw").value);r[0]=c&&g?(c+g)/2:c||g;r[1]=b&&h?(b+h)/2:b||h;r[2]=k&&m?(k+m)/2:k||m;t[0]=document.querySelector("#U1max").value?
Number(document.querySelector("#U1max").value)/100:1;t[1]=document.querySelector("#U2max").value?Number(document.querySelector("#U2max").value)/100:1;t[2]=document.querySelector("#U3max").value?Number(document.querySelector("#U3max").value)/100:1;c=Array.from(document.querySelectorAll(".U1skillsw1")).map(function(a){return a.value?Number(a.value):0});var d=Array.from(document.querySelectorAll(".U1skillsw-counter1")).map(function(a){return a.value?Number(a.value):0});g=Array.from(document.querySelectorAll(".U1skillsw2")).map(function(a){return a.value?
Number(a.value):0});var q=Array.from(document.querySelectorAll(".U1skillsw-counter2")).map(function(a){return a.value?Number(a.value):0});b=Array.from(document.querySelectorAll(".U1skillsw3")).map(function(a){return a.value?Number(a.value):0});var F=Array.from(document.querySelectorAll(".U1skillsw-counter3")).map(function(a){return a.value?Number(a.value):0});h=Array.from(document.querySelectorAll(".U2skillsw1")).map(function(a){return a.value?Number(a.value):0});var G=Array.from(document.querySelectorAll(".U2skillsw-counter1")).map(function(a){return a.value?
Number(a.value):0});k=Array.from(document.querySelectorAll(".U2skillsw2")).map(function(a){return a.value?Number(a.value):0});var H=Array.from(document.querySelectorAll(".U2skillsw-counter2")).map(function(a){return a.value?Number(a.value):0});m=Array.from(document.querySelectorAll(".U2skillsw3")).map(function(a){return a.value?Number(a.value):0});var I=Array.from(document.querySelectorAll(".U2skillsw-counter3")).map(function(a){return a.value?Number(a.value):0}),B=Array.from(document.querySelectorAll(".U3skillsw1")).map(function(a){return a.value?
Number(a.value):0}),J=Array.from(document.querySelectorAll(".U3skillsw-counter1")).map(function(a){return a.value?Number(a.value):0}),C=Array.from(document.querySelectorAll(".U3skillsw2")).map(function(a){return a.value?Number(a.value):0}),K=Array.from(document.querySelectorAll(".U3skillsw-counter2")).map(function(a){return a.value?Number(a.value):0}),D=Array.from(document.querySelectorAll(".U3skillsw3")).map(function(a){return a.value?Number(a.value):0}),L=Array.from(document.querySelectorAll(".U3skillsw-counter3")).map(function(a){return a.value?
Number(a.value):0});c.length&&c.length==d.length&&c.forEach(function(a,f){a&&u.push([1,a,d[f]])});g.length&&g.length==q.length&&g.forEach(function(a,f){a&&v.push([1,a,q[f]])});b.length&&b.length==F.length&&b.forEach(function(a,f){a&&w.push([1,a,F[f]])});h.length&&h.length==G.length&&h.forEach(function(a,f){a&&u.push([2,a,G[f]])});k.length&&k.length==H.length&&k.forEach(function(a,f){a&&v.push([2,a,H[f]])});m.length&&m.length==I.length&&m.forEach(function(a,f){a&&w.push([2,a,I[f]])});B.length&&B.length==
J.length&&B.forEach(function(a,f){a&&u.push([3,a,J[f]])});C.length&&C.length==K.length&&C.forEach(function(a,f){a&&v.push([3,a,K[f]])});D.length&&D.length==L.length&&D.forEach(function(a,f){a&&w.push([3,a,L[f]])});c=Array.from(document.querySelectorAll(".U1skillacc")).map(function(a){return a.value?Number(a.value):0});var M=Array.from(document.querySelectorAll(".U1skillacc-max")).map(function(a){return a.value?Number(a.value):0});g=Array.from(document.querySelectorAll(".U2skillacc")).map(function(a){return a.value?
Number(a.value):0});var N=Array.from(document.querySelectorAll(".U2skillacc-max")).map(function(a){return a.value?Number(a.value):0});b=Array.from(document.querySelectorAll(".U3skillacc")).map(function(a){return a.value?Number(a.value):0});var O=Array.from(document.querySelectorAll(".U3skillacc-max")).map(function(a){return a.value?Number(a.value):0});c.length&&c.length==M.length&&c.forEach(function(a,f){a&&x.push([a/100,M[f]/100])});g.length&&g.length==N.length&&g.forEach(function(a,f){a&&y.push([a/
100,N[f]/100])});b.length&&b.length==O.length&&b.forEach(function(a,f){a&&z.push([a/100,O[f]/100])});c=Array.from(document.querySelectorAll(".U1exboost-time")).map(function(a){return a.value?Number(a.value):0});var P=Array.from(document.querySelectorAll(".U1exboost-charge")).map(function(a){return a.value?Number(a.value):0});g=Array.from(document.querySelectorAll(".U2exboost-time")).map(function(a){return a.value?Number(a.value):0});var Q=Array.from(document.querySelectorAll(".U2exboost-charge")).map(function(a){return a.value?
Number(a.value):0});b=Array.from(document.querySelectorAll(".U3exboost-time")).map(function(a){return a.value?Number(a.value):0});var R=Array.from(document.querySelectorAll(".U3exboost-charge")).map(function(a){return a.value?Number(a.value):0});c.length&&c.length==P.length&&c.forEach(function(a,f){a&&E.push([a,1,P[f]])});g.length&&g.length==Q.length&&g.forEach(function(a,f){a&&E.push([a,2,Q[f]])});b.length&&b.length==R.length&&b.forEach(function(a,f){a&&E.push([a,3,R[f]])});E.length&&E.sort(function(a,
f){return a[0]-f[0]})}
function U(){function c(){if(r[0]>b[0]&&r[1]>b[1]&&r[2]>b[2]){var d=Math.min((r[0]-b[0])/A[0],(r[1]-b[1])/A[1],(r[2]-b[2])/A[2]);return E.length?Math.ceil(k+Math.min(d,E[0][0])):Math.ceil(k+d)}return k}function g(){r[0]<=b[0]?(b[0]-=r[0],u.forEach(function(d){if(0==d[2]||h[0]<d[2])b[d[0]-1]+=d[1]/100*r[d[0]-1]}),h[0]+=1,A[0]=1+x.map(function(d){return Math.min(d[1],d[0]*h[0])}).reduce(function(d,q){return d+q},0),S.push([1,k])):r[1]<=b[1]?(b[1]-=r[1],v.forEach(function(d){if(0==d[2]||h[1]<d[2])b[d[0]-
1]+=d[1]/100*r[d[0]-1]}),h[1]+=1,A[1]=1+y.map(function(d){return Math.min(d[1],d[0]*h[1])}).reduce(function(d,q){return d+q},0),S.push([2,k])):r[2]<=b[2]&&(b[2]-=r[2],w.forEach(function(d){if(0==d[2]||h[2]<d[2])b[d[0]-1]+=d[1]/100*r[d[0]-1]}),h[2]+=1,A[2]=1+z.map(function(d){return Math.min(d[1],d[0]*h[2])}).reduce(function(d,q){return d+q},0),S.push([3,k]))}if(r[0]&&r[1]&&r[2]){S=[];var b=[0,0,0],h=[0,0,0],k=0,m=0;b[0]=document.querySelector("#U1start").value?Math.min(r[0]*Number(document.querySelector("#U1start").value)/
100,t[0]*r[0]):0;b[1]=document.querySelector("#U2start").value?Math.min(r[1]*Number(document.querySelector("#U2start").value)/100,t[1]*r[1]):0;for(b[2]=document.querySelector("#U3start").value?Math.min(r[2]*Number(document.querySelector("#U3start").value)/100,t[2]*r[2]):0;3E3>k||30>S.length;){m=c();m==k?g():(b[0]+=(m-k)*A[0],b[1]+=(m-k)*A[1],b[2]+=(m-k)*A[2],k=m);for(;E.length&&k==E[0][0];)b[E[0][1]-1]+=E[0][2]/100*r[E[0][1]-1],E.shift();b[0]=Math.min(t[0]*r[0],b[0]);b[1]=Math.min(t[1]*r[1],b[1]);
b[2]=Math.min(t[2]*r[2],b[2])}}}
function V(){document.querySelector("#U1").innerHTML="";document.querySelector("#U2").innerHTML="";document.querySelector("#U3").innerHTML="";document.querySelector("#U1_sw").innerHTML=r[0];document.querySelector("#U2_sw").innerHTML=r[1];document.querySelector("#U3_sw").innerHTML=r[2];var c=[[null,null],[null,null],[null,null]],g=[0,0,0];S.forEach(function(b){var h=document.createElement("div"),k=document.createElement("div");if(null!==c[b[0]-1][0])if(b[1]-100>c[b[0]-1][0])h.style.height=String((b[1]-
c[b[0]-1][0])/5-20-g[b[0]-1])+"px",g[b[0]-1]=0;else{c[b[0]-1][1].innerHTML+="/"+String(b[1]);c[b[0]-1][1].style.height=String(Math.max(20,Number(c[b[0]-1][1].style.height.slice(0,-2)))+(b[1]-c[b[0]-1][0])/5)+"px";g[b[0]-1]+=(b[1]-c[b[0]-1][0])/5;return}else h.style.height=String(b[1]/5)+"px";k.innerHTML=b[1];c[b[0]-1]=[b[1],k];h.style.backgroundColor="transparent";document.querySelector("#U"+String(b[0])).appendChild(h);document.querySelector("#U"+String(b[0])).appendChild(k)})}
function p(){console.log("start simulation");var c=Date.now();T();U();V();console.log(String(Date.now()-c)+"ms")};